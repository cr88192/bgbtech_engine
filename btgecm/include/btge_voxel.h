#define VOX_TY_AIR					0
#define VOX_TY_STONE				1
#define VOX_TY_GRASS				2
#define VOX_TY_DIRT					3
#define VOX_TY_COBBLESTONE			4
#define VOX_TY_WOOD					5
#define VOX_TY_SAPLING				6
#define VOX_TY_BEDROCK				7
#define VOX_TY_WATER				8
#define VOX_TY_WATER2				9
#define VOX_TY_LAVA					10
#define VOX_TY_LAVA2				11
#define VOX_TY_SAND					12
#define VOX_TY_GRAVEL				13
#define VOX_TY_GOLDORE				14
#define VOX_TY_IRONORE				15
#define VOX_TY_COAL					16
#define VOX_TY_LOG					17
#define VOX_TY_LEAVES				18
#define VOX_TY_SPONGE				19
#define VOX_TY_GLASS				20
#define VOX_TY_LAPIS_ORE			21
#define VOX_TY_LAPIS_BLOCK			22
#define VOX_TY_DISPENSER			23
#define VOX_TY_SANDSTONE			24
#define VOX_TY_NOTE_BLOCK			25
#define VOX_TY_BED					26
#define VOX_TY_POWERED_RAIL			27
#define VOX_TY_DETECTOR_RAIL		28
#define VOX_TY_STICKY_PISTON		29
#define VOX_TY_COBWEB				30
#define VOX_TY_TALL_GRASS			31
#define VOX_TY_DEAD_BUSH			32
#define VOX_TY_PISTON				33
#define VOX_TY_PISTON_HEAD			34
#define VOX_TY_CLOTH				35
#define VOX_TY_BLOCK_TRANSIT		36
#define VOX_TY_FLOWER_YEL			37
#define VOX_TY_FLOWER_RED			38
#define VOX_TY_SHROOM_BROWN			39
#define VOX_TY_SHROOM_RED			40
#define VOX_TY_BLOCK_GOLD			41
#define VOX_TY_BLOCK_IRON			42
#define VOX_TY_DOUBLESLAB			43
#define VOX_TY_SLAB					44
#define VOX_TY_BRICK				45
#define VOX_TY_TNT					46
#define VOX_TY_BOOKSHELF			47
#define VOX_TY_MOSS_STONE			48
#define VOX_TY_OBSIDIAN				49
#define VOX_TY_TORCH				50
#define VOX_TY_FIRE					51
#define VOX_TY_MOBSPAWNER			52
#define VOX_TY_WOOD_STAIRS			53
#define VOX_TY_CHEST				54
#define VOX_TY_REDSTONE_WIRE		55
#define VOX_TY_DIAMOND_ORE			56
#define VOX_TY_DIAMOND_BLOCK		57
#define VOX_TY_CRAFTING_TABLE		58
#define VOX_TY_SEEDS				59
#define VOX_TY_FARMLAND				60
#define VOX_TY_FURNACE				61
#define VOX_TY_FURNACE_LIT			62
#define VOX_TY_SIGN_POST			63
#define VOX_TY_WOOD_DOOR			64
#define VOX_TY_LADDER				65
#define VOX_TY_RAIL					66
#define VOX_TY_COBBLE_STAIRS		67
#define VOX_TY_WALL_SIGN			68
#define VOX_TY_LEVER				69
#define VOX_TY_STONE_PLATE			70
#define VOX_TY_IRON_DOOR			71
#define VOX_TY_WOOD_PLATE			72
#define VOX_TY_REDSTONE_ORE			73
#define VOX_TY_REDSTONE_ORE2		74
#define VOX_TY_REDSTONE_TORCH0		75
#define VOX_TY_REDSTONE_TORCH1		76
#define VOX_TY_STONE_BUTTON			77
#define VOX_TY_SNOW					78
#define VOX_TY_ICE					79
#define VOX_TY_SNOW_BLOCK			80
#define VOX_TY_CACTUS				81
#define VOX_TY_CLAY_BLOCK			82
#define VOX_TY_SUGAR_CANE			83
#define VOX_TY_JUKEBOX				84
#define VOX_TY_FENCE				85
#define VOX_TY_PUMPKIN				86
#define VOX_TY_NETHERRACK			87
#define VOX_TY_SOULSAND				88
#define VOX_TY_GLOWSTONE			89
#define VOX_TY_PORTAL				90
#define VOX_TY_JACKOLANTERN			91
#define VOX_TY_CAKEBLOCK			92
#define VOX_TY_REDSTONE_RELAY0		93
#define VOX_TY_REDSTONE_RELAY1		94
// #define VOX_TY_CHEST_LOCKED			95
#define VOX_TY_INVISIBLE_BEDROCK	95
#define VOX_TY_TRAPDOOR				96
#define VOX_TY_SILVERFISH			97
#define VOX_TY_STONE_BRICK			98
#define VOX_TY_SHROOM_BROWN_HUGE	99
#define VOX_TY_SHROOM_RED_HUGE		100
#define VOX_TY_IRON_BARS			101
#define VOX_TY_GLASS_PANE			102
#define VOX_TY_MELON				103
#define VOX_TY_PUMPKIN_STEM			104
#define VOX_TY_MELON_STEM			105
#define VOX_TY_VINES				106
#define VOX_TY_FENCE_GATE			107
#define VOX_TY_BRICK_STAIRS			108
#define VOX_TY_STONEBRICK_STAIRS	109
#define VOX_TY_MYCELIUM				110
#define VOX_TY_LILYPAD				111
#define VOX_TY_NETHERBRICK			112
#define VOX_TY_NETHERBRICK_FENCE	113
#define VOX_TY_NETHERBRICK_STAIRS	114
#define VOX_TY_NETHERWART			115
#define VOX_TY_ENCHANT_TABLE		116
#define VOX_TY_BREWSTAND			117
#define VOX_TY_CAULDRON				118
#define VOX_TY_AIRPORTAL			119
#define VOX_TY_CRYSTAL				120

#define VOX_TY_ENDSTONE				121
#define VOX_TY_DRAGON_EGG			122
#define VOX_TY_REDSTONE_LAMP0		123
#define VOX_TY_REDSTONE_LAMP1		124
#define VOX_TY_WOOD_DOUBLESLAB		125
#define VOX_TY_WOOD_SLAB			126
#define VOX_TY_COCOA_PLANT			127
#define VOX_TY_SANDSTONE_STAIRS		128
#define VOX_TY_EMERALD_ORE			129
#define VOX_TY_ENDER_CHEST			130
#define VOX_TY_TRIPWIRE_HOOK		131
#define VOX_TY_TRIPWIRE				132
#define VOX_TY_EMERALD_BLOCK		133
#define VOX_TY_SPRUCE_STAIRS		134
#define VOX_TY_BIRCH_STAIRS			135
#define VOX_TY_JUNGLE_STAIRS		136
#define VOX_TY_COMMAND_BLOCK		137
#define VOX_TY_BEACON_BLOCK			138
#define VOX_TY_COBBLESTONE_WALL		139
#define VOX_TY_FLOWER_POT			140
#define VOX_TY_CARROTS				141
#define VOX_TY_POTATOES				142
#define VOX_TY_WOOD_BUTTON			143

#define VOX_TY_LEAVES2				161
#define VOX_TY_LOG2					162
#define VOX_TY_ACACIA_STAIRS		163
#define VOX_TY_DARKOAK_STAIRS		164
#define VOX_TY_BOUNCY_SLIME			165

#define VOX_TY_REDSTONE_PIPE		256
#define VOX_TY_GREENSTONE_PIPE		257
#define VOX_TY_BLUESTONE_PIPE		258
#define VOX_TY_GREENSTONE_TORCH0	259
#define VOX_TY_GREENSTONE_TORCH1	260
#define VOX_TY_BLUESTONE_TORCH0		261
#define VOX_TY_BLUESTONE_TORCH1		262
#define VOX_TY_GREENSTONE_WIRE		263
#define VOX_TY_BLUESTONE_WIRE		264
#define VOX_TY_GOLDSTONE_WIRE		265
#define VOX_TY_GOLDSTONE_PIPE		266
#define VOX_TY_GOLDSTONE_TORCH0		267
#define VOX_TY_GOLDSTONE_TORCH1		268

#define VOX_TY_COMP_INNARDS			269
#define VOX_TY_COMP_PANEL			270
#define VOX_TY_PANEL_GRATE			271
#define VOX_TY_PANEL_HEX			272
#define VOX_TY_PANEL_PIPES			273

#define VOX_TY_REDSTONE_GATE_AND	274
#define VOX_TY_REDSTONE_GATE_OR		275
#define VOX_TY_REDSTONE_GATE_XOR	276
#define VOX_TY_REDSTONE_GATE_NAND	277
#define VOX_TY_REDSTONE_GATE_NOR	278
#define VOX_TY_REDSTONE_GATE_XNOR	279

#define VOX_TY_SLIME				280			//normal toxic slime
#define VOX_TY_SLIME2				281			//normal toxic slime
#define VOX_TY_GLOWSLIME			282			//green glowing slime
#define VOX_TY_GLOWSLIME2			283			//green glowing slime
#define VOX_TY_BLOCK_RUST			284			//rusted metal block
#define VOX_TY_PANEL_PI				285			//PI panel, plays a song
#define VOX_TY_GRATE_HEX			286			//rusted metal block
#define VOX_TY_GRATE_SQUARE			287			//PI panel, plays a song

#define VOX_TY_PANEL_VIDEO1			288			//video panel 1
#define VOX_TY_PANEL_VIDEO2			289			//video panel 2
#define VOX_TY_PANEL_VIDEO3			290			//video panel 3
#define VOX_TY_PANEL_VIDEO4			291			//video panel 4
#define VOX_TY_PANEL_VIDEO5			292			//video panel 1
#define VOX_TY_PANEL_VIDEO6			293			//video panel 2
#define VOX_TY_PANEL_VIDEO7			294			//video panel 3
#define VOX_TY_PANEL_VIDEO8			295			//video panel 4
#define VOX_TY_BLOCK_RUST2			296			//rusted metal block (2)
#define VOX_TY_BLOCK_RUST3			297			//rusted metal block (3)
#define VOX_TY_BLOCK_RUST4			298			//rusted metal block (4)
#define VOX_TY_BLOCK_RUST5			299			//rusted metal block (5)
#define VOX_TY_BLOCK_RUST6			300			//rusted metal block (6)
#define VOX_TY_BLOCK_RUST7			301			//rusted metal block (7)
#define VOX_TY_BLOCK_RUST8			302			//rusted metal block (8)
#define VOX_TY_BLOCK_RUST9			303			//rusted metal block (9)

#define VOX_TYM_NORMAL				0x0000		//normal (cube shaped)
#define VOX_TYM_UNBREAKABLE			0x1000		//unbreakable
#define VOX_TYM_FLEXFORM			0x2000
#define VOX_TYM_POWERED				0x8000		//powered (weak)
#define VOX_TYM_POWERED2			0x9000		//powered (strong)
#define VOX_TYM_UB_POWERED			0xA000		//unbreakable powered (weak)
#define VOX_TYM_UB_POWERED2			0xB000		//unbreakable powered (strong)

#define VOX_TYS_UB_AIR				VOX_TYM_UNBREAKABLE
#define VOX_TYS_ANYSOLIDBLOCK		VOX_TYM_FLEXFORM

#define VOX_TY_MASK					0x0FFF
#define VOX_TYM_MASK				0xF000

#define VOX_FL_NX			1
#define VOX_FL_PX			2
#define VOX_FL_NY			4
#define VOX_FL_PY			8
#define VOX_FL_NZ			16
#define VOX_FL_PZ			32

#define VOX_FL_ALL_CUBE		63

#define VOX_FL_NXPZ			64
#define VOX_FL_PXPZ			128
#define VOX_FL_NYPZ			256
#define VOX_FL_PYPZ			512

#define VOX_FL_NXPY			1024
#define VOX_FL_PXNY			2048
#define VOX_FL_PXPY			4096
#define VOX_FL_NXNY			8192

#define VOX_FL_NXPYPZ		16384
#define VOX_FL_PXNYPZ		32768
#define VOX_FL_PXPYPZ		65536
#define VOX_FL_NXNYPZ		131072

#define VOX_AXFL_RELAY_NORTH		0
#define VOX_AXFL_RELAY_EAST			1
#define VOX_AXFL_RELAY_SOUTH		2
#define VOX_AXFL_RELAY_WEST			3
#define VOX_AXFL_RELAY_UP			4
#define VOX_AXFL_RELAY_DOWN			5

#define VOX_AXFL_TORCH_EAST			1
#define VOX_AXFL_TORCH_WEST			2
#define VOX_AXFL_TORCH_SOUTH		3
#define VOX_AXFL_TORCH_NORTH		4
#define VOX_AXFL_TORCH_STAND		5
#define VOX_AXFL_TORCH_INGROUND		6	//?

#define VOX_AXFL_RAIL_NORTH_SOUTH	0
#define VOX_AXFL_RAIL_EAST_WEST		1
#define VOX_AXFL_RAIL_ASCEND_EAST	2
#define VOX_AXFL_RAIL_ASCEND_WEST	3
#define VOX_AXFL_RAIL_ASCEND_NORTH	4
#define VOX_AXFL_RAIL_ASCEND_SOUTH	5

#define VOX_AXFL_RAIL_EAST_SOUTH	6
#define VOX_AXFL_RAIL_WEST_SOUTH	7
#define VOX_AXFL_RAIL_WEST_NORTH	8
#define VOX_AXFL_RAIL_EAST_NORTH	9

#define VOX_AXFL_STAIRS_EAST		0
#define VOX_AXFL_STAIRS_WEST		1
#define VOX_AXFL_STAIRS_SOUTH		2
#define VOX_AXFL_STAIRS_NORTH		3

#define VOX_AXFL_PISTON_DOWN		0
#define VOX_AXFL_PISTON_UP			1
#define VOX_AXFL_PISTON_NORTH		2
#define VOX_AXFL_PISTON_SOUTH		3
#define VOX_AXFL_PISTON_WEST		4
#define VOX_AXFL_PISTON_EAST		5

#define VOX_AXFL_LADDER_DOWN		0
#define VOX_AXFL_LADDER_UP			1
#define VOX_AXFL_LADDER_NORTH		2
#define VOX_AXFL_LADDER_SOUTH		3
#define VOX_AXFL_LADDER_WEST		4
#define VOX_AXFL_LADDER_EAST		5

#define VOX_AXFL_DOOR_WEST		0
#define VOX_AXFL_DOOR_NORTH		1
#define VOX_AXFL_DOOR_EAST		2
#define VOX_AXFL_DOOR_SOUTH		3


#define VOX_CHFL_OLDTICKDIRTY			1
#define VOX_CHFL_DELTADIRTY				2
#define VOX_CHFL_DELTAOK				4
#define VOX_CHFL_DELTA_ACTIVE			8
#define VOX_CHFL_SAVE_OK				16
#define VOX_CHFL_SKIP_SUN				32		//no sunlight here
#define VOX_CHFL_LIGHT_DIRTY			64		//light needs to be updated
#define VOX_CHFL_SKIP_VLIGHT			128		//no voxel-light here
#define VOX_CHFL_OLDTICKACTIVE			256
#define VOX_CHFL_USESHADER				512		//chunk uses shader system
#define VOX_CHFL_VISCLIP				1024	//chunk is not visible
#define VOX_CHFL_ALPHAVISCLIP			2048	//chunk is not visible
#define VOX_CHFL_LIGHTVISCLIP			4096	//no lights are visible
#define VOX_CHFL_REBUILDING				8192	//currently rebuilding chunk
#define VOX_CHFL_VBODIRTY				16384	//VBO is dirty
#define VOX_CHFL_NOVISBLOCKS			32768	//no visible blocks
#define VOX_CHFL_DISTANT				65536	//chunk is not near camera
#define VOX_CHFL_ALPHALIGHTMAT			131072	//alpha light material
#define VOX_CHFL_PACKINDEX				262144	//uses packed indices
#define VOX_CHFL_NOPACKINDEX			524288	//disable packed indices
#define VOX_CHFL_PACKINDEX4				1048576	//4-bit packed indices
#define VOX_CHFL_HASSOUNDBLOCK			2097152	//has sound-source blocks

#define VOX_GFL_DIRTY					1		//mark as dirty
#define VOX_GFL_REBUILD					2		//chunk needs rebuild
#define VOX_GFL_DELTA_LOAD				4		//change due to delta/loading
#define VOX_GFL_ENTITY_MOVE				8		//an entity has moved
#define VOX_GFL_SKIP_LOAD				16		//don't load chunks

#define VOX_TGFL_BORDERS				1
#define VOX_TGFL_ORES					2
#define VOX_TGFL_CAVES					4
#define VOX_TGFL_PANELS					8
#define VOX_TGFL_SPAWNERS				16
#define VOX_TGFL_SUN_AMBIENT			32		//sunlight is ambient

#define BTGE_VOXEL_BYTERGBA				//store RGBA as bytes.

#define VOX_DTAG_CHUNK					0x01	//delta tag chunk
#define VOX_DTAG_RGNDELTA_BEGIN			0x02	//delta tag chunk
#define VOX_DTAG_RGNDELTA_END			0x03	//delta tag chunk
#define VOX_DTAG_WDELTA_BEGIN			0x04	//delta tag chunk
#define VOX_DTAG_WDELTA_END				0x05	//delta tag chunk
#define VOX_DTAG_RGNVALUES_BEGIN		0x06	//delta tag chunk
#define VOX_DTAG_RGNVALUES_END			0x07	//delta tag chunk
#define VOX_DTAG_VOXTYPES_BEGIN			0x08	//delta tag chunk
#define VOX_DTAG_VOXTYPES_END			0x09	//delta tag chunk

//raw planes
#define VOX_DCHK_END					0x00	//end of chunk
#define VOX_DCHK_TYPEL					0x01	//type low plane
#define VOX_DCHK_AUX					0x02	//aux plane
#define VOX_DCHK_TYPEH					0x03	//type high plane
#define VOX_DCHK_AUX2L					0x04	//aux2 low
#define VOX_DCHK_AUX2H					0x05	//aux2 high
#define VOX_DCHK_VLIGHT					0x06	//block light
#define VOX_DCHK_SLIGHT					0x07	//sun light
//8-15=reserved

//index planes
#define VOX_DCHK_INDEX					0x10	//index plane
#define VOX_DCHK_IDXTYPEL				0x11	//type low plane
#define VOX_DCHK_IDXAUX					0x12	//aux plane
#define VOX_DCHK_IDXTYPEH				0x13	//type high plane
#define VOX_DCHK_IDXAUX2L				0x14	//aux2 low
#define VOX_DCHK_IDXAUX2H				0x15	//aux2 high
#define VOX_DCHK_IDXVLIGHT				0x16	//block light
#define VOX_DCHK_IDXSLIGHT				0x17	//sun light

#define VOX_DCHK_BIOME					0x21	//chunk biome type
#define VOX_DCHK_SZINDEX				0x22	//size of index
#define VOX_DCHK_DUNGEON_TYPE			0x23	//dungeon type
#define VOX_DCHK_DUNGEON_ATTR			0x24	//dungeon attributes

#define VOX_BIOME_DEFAULT				0x00	//no biome (med, med, med)
#define VOX_BIOME_PLAINS				0x01	//plains biome (med, dry)
#define VOX_BIOME_DESERT				0x02	//desert (hot, dry)
#define VOX_BIOME_HILLS					0x03	//hills (arcane, med, med)
#define VOX_BIOME_FOREST				0x04	//forest (med, med)
#define VOX_BIOME_TAIGA					0x05	//taiga (cold, med)
#define VOX_BIOME_SWAMP					0x06	//swamp (med, wet)
#define VOX_BIOME_JUNGLE				0x07	//jungle (hot, wet)
#define VOX_BIOME_HELL					0x08	//hell (arcane, hot, dry)
#define VOX_BIOME_SKY					0x09	//sky (arcane, med, dry)
#define VOX_BIOME_MUSHROOM				0x0A	//mushroom (arcane, hot, wet)
#define VOX_BIOME_ACID					0x0B	//acid (arcane, hot, med)
#define VOX_BIOME_METAL					0x0C	//metal (arcane, med, wet)
#define VOX_BIOME_TUNDRA				0x0D	//tundra (cold, wet)

#define VOX_BIFL_TREES2X				0x01	//2x trees
#define VOX_BIFL_TREES4X				0x02	//4x trees
#define VOX_BIFL_TREES8X				0x04	//8x trees
#define VOX_BIFL_TREESNX				0x08	//invert trees

#define VOX_BIFL_HILLS2X				0x10	//invert 2x
#define VOX_BIFL_HILLS4X				0x20	//invert 4x
#define VOX_BIFL_HILLSNX				0x40	//invert hills

// typedef struct BTGE_VoxelInfo_s BTGE_VoxelInfo;
// typedef struct BTGE_VoxelChunk_s BTGE_VoxelChunk;
// typedef struct BTGE_VoxelRegion_s BTGE_VoxelRegion;

// typedef struct BTGE_VoxelTerrGen_s BTGE_VoxelTerrGen;
// typedef struct BTGE_NoiseContext_s BTGE_NoiseContext;

struct BTGE_VoxelInfo_s {
char *name;			//name of voxel type
int img_top;		//top texture
int img_side;		//side texture
int img_bot;		//bottom texture
int flags;			//combined flags
int flags2;			//combined flags2
int flags3;			//combined flags3
int flags4;			//combined flags4
byte vlight;		//voxel light
byte vlight_style;	//light style

int img_auxvar_top[8];
int img_auxvar_side[8];
int img_auxvar_bot[8];

float mins[4*3];
float maxs[4*3];

float img_scale[3];
float blast_resist;

char *sound_name;		//emit sound
float sound_vol;		//sound volume
int sound_attn;			//sound attenuation

//emit geometry for block
void (*EmitBlock)(
	BTGE_BrushWorld *world, 
	BTGE_VoxelChunk *chk, BTGE_VoxelData *vox,
	float *min, float *max, int flag,
	int x, int y, int z);

//think event
void (*BlockThink)(
	BTGE_BrushWorld *world, BTGE_VoxelChunk *chk,
	BTGE_VoxelData *vox, int x, int y, int z);

//update event
void (*BlockUpdate)(
	BTGE_BrushWorld *world, BTGE_VoxelChunk *chk,
	BTGE_VoxelData *vox, int x, int y, int z);

//block was hit with damage less-than blast_resist
int (*SmallDamageEvent)(
	BTGE_BrushWorld *world, BTGE_VoxelData *vox,
	int x, int y, int z, double *org,
	float radius, float damage, float dmg);

//block was hit with damage greater-than blast_resist
int (*LargeDamageEvent)(
	BTGE_BrushWorld *world, BTGE_VoxelData *vox,
	int x, int y, int z, double *org,
	float radius, float damage, float dmg);

//update the power for a voxel (s=self, o=other)
int (*UpdatePower)(
	BTGE_BrushWorld *world, BTGE_VoxelChunk *chk,
	BTGE_VoxelData *svox, BTGE_VoxelData *ovox,
	int sx, int sy, int sz,
	int ox, int oy, int oz,
	int pwr);

//get power output for a voxel (s=self, o=other)
int (*GetPower)(
	BTGE_BrushWorld *world, BTGE_VoxelChunk *chk,
	BTGE_VoxelData *svox, BTGE_VoxelData *ovox,
	int sx, int sy, int sz,
	int ox, int oy, int oz);

int (*GetWorldVoxelBBoxList)(
	BTGE_BrushWorld *world,
	int x, int y, int z, int fl,
	float *mins, float *maxs, int max);

//touch event
void (*TouchEvent)(
	BTGE_BrushWorld *world, BTGE_VoxelData *vox,
		int x, int y, int z, int fl, btEntity ent);

//random think event
void (*RandomThink)(
	BTGE_BrushWorld *world, BTGE_VoxelData vox,
	int x, int y, int z, int fl);
};

struct BTGE_VoxelData_s {
u16 type;		//low 12: voxel type, high 4: mode
u16 aux2;		//low 14 bits: situation specific, high 2: tag (1)
byte aux;		//high 4: sun-light, low 4: block-specific
byte delay;		//tick delay to update
byte vlight;	//voxel-light, high 4: light-power, low-4: light color
byte slight;	//sun-light, high 4: light-power, low-4: light color
//consider: 16-bit aux and 8 bit light (4.4)
};

struct BTGE_VoxelElasticNode_s {
BTGE_VoxelElasticNode *next;
int x, y, z;			//voxel coords
float org[3];			//point origin for voxel
BTGE_VoxelData *vox;	//voxel data
BTGE_VoxelElasticNode *link[6];
};

struct BTGE_VoxelElasticVertex_s {
BTGE_VoxelElasticVertex *next;
BTGE_VoxelElasticVertex *gnext;		//global next (world vertices)
float org[3];			//point origin for voxel
float oldorg[3];		//original origin
int flags;
};

struct BTGE_VoxelElasticFace_s {
BTGE_VoxelElasticFace *next;
int x, y, z;			//voxel coords
BTGE_VoxelData *vox;	//voxel data
BTGE_VoxelElasticVertex *vert[4];
float brgba[4];
float slrgba[4];
float vlrgba[4];
int tex;
};

//1: aux2.tag:
//	0=block-type specific
//    low 14 bits may be used however needed by block
//  1=region data lump
//    low 14 bits serve to index an object (block-type specific)
//  2/3: reserved

struct BTGE_VoxelChunk_s {
BTGE_VoxelRegion *rgn;		//owning region
BTGE_VoxelData *vox;		//voxel array
int ox, oy, oz;				//origin (voxel space)
int xs, ys, zs;				//size (voxels)
byte clean;					//geometry not dirty
byte tickdirty;				//marked dirty for tick
byte tickthink;				//marked for think
byte tickactive;			//indicates whether ticks are active for chunk

int flags;					//chunk bit flags
int visid;					//chunk visable id

BTGE_VoxelChunkMesh *mesh;	//chunk mesh data
int voxrle;					//RLE pack voxel data (offset)
int sz_voxrle;				//size of voxel RLE
byte *tmprle;				//RLE pack voxel data (temp)

BTGE_VoxelData *pidx_vox;	//packed index voxels
byte *pidx_idx;				//packed voxel indices
short pidx_n_vox;			//packed-index: num voxels
short pidx_m_vox;			//packed-index: max voxels

byte tick_inhibit_voxrle;	//ticks inhibiting voxel RLE
byte biome;					//biome ID
byte dungeon_type;			//dungeon type
byte dungeon_attr;			//dungeon attribute

//query state
float tmp_dist;				//temp distance
BTGE_VoxelChunk *chain;		//visible next
};

struct BTGE_VoxelChunkMesh_s {
//visible faces (quads)
float *face_xyz;			//XYZ
float *face_st;				//ST
#ifndef BTGE_VOXEL_BYTERGBA
float *face_norm;			//normals (XYZ)
float *face_rgba;			//base color (RGBA)
float *face_slrgba;			//sun-light color (RGBA)
float *face_vlrgba;			//vox-light color (RGBA)
#else
sbyte *face_norm;			//normals (XYZ)
sbyte *face_norm_x;			//X normals (XYZ)
sbyte *face_norm_y;			//Y normals (XYZ)
byte *face_rgba;			//base color (RGBA)
byte *face_slrgba;			//sun-light color (RGBA)
byte *face_vlrgba;			//vox-light color (RGBA)
byte *face_tlrgba;			//temp light color (RGBA)
#endif
int *face_tex;				//texture
//BTGE_VoxelData **face_vox;	//voxel array
BTGE_VoxelData *face_vox;	//voxel array
int n_face, m_face;

//visible alpha faces (quads)
float *aface_xyz;			//XYZ
float *aface_st;			//ST
#ifndef BTGE_VOXEL_BYTERGBA
float *aface_norm;			//normals (XYZ)
float *aface_rgba;			//base color (RGBA)
float *aface_slrgba;		//sun-light color (RGBA)
float *aface_vlrgba;		//vox-light color (RGBA)
#else
sbyte *aface_norm;			//normals (XYZ)
byte *aface_rgba;			//base color (RGBA)
byte *aface_slrgba;			//sun-light color (RGBA)
byte *aface_vlrgba;			//vox-light color (RGBA)
byte *aface_tlrgba;			//temp light color (RGBA)
#endif
int *aface_tex;				//texture
//BTGE_VoxelData **aface_vox;	//voxel array
BTGE_VoxelData *aface_vox;	//voxel array
int n_aface, m_aface;

//mesh geometry
float *mesh_xyz;		//XYZ
float *mesh_norm;		//XYZ
int *mesh_edge;			//v0 v1 n0 n1
int *mesh_pts;			//xyz st
int *mesh_face;			//pt cnt
int n_mesh_xyz;
int n_mesh_norm;
int n_mesh_edge;
int n_mesh_pts;
int n_mesh_face;

BTGE_Light *light;			//voxel lights
BTGE_ModelState *props;		//model props

BTGE_VoxelElasticNode *esn_node;
BTGE_VoxelElasticVertex *esn_vertex;
BTGE_VoxelElasticFace *esn_face;

BTGE_VoxelChunk *vnext;		//visible next
BTGE_VoxelChunk *avnext;	//alpha visible next
BTGE_VoxelChunk *lvnext;	//light visible next
BTGE_VoxelChunk *svnext;	//shadow visible next

BTGE_VoxelChunk *wvnext;	//world visible next
BTGE_VoxelChunk *wavnext;	//world alpha visible next

//VBOs
int vbo_face;
int vbo_aface;

//solid face VBO
int vbo_face_xyz;			//XYZ
int vbo_face_st;			//ST
int vbo_face_norm;			//normals (XYZ)
int vbo_face_norm_x;		//X normals (XYZ)
int vbo_face_norm_y;		//Y normals (XYZ)
int vbo_face_rgba;			//base color (RGBA)
int vbo_face_slrgba;		//sun-light color (RGBA)
int vbo_face_vlrgba;		//vox-light color (RGBA)
int vbo_face_tlrgba;		//temp light color (RGBA)

//alpha face VBO
int vbo_aface_xyz;			//XYZ
int vbo_aface_st;			//ST
int vbo_aface_norm;			//normals (XYZ)
int vbo_aface_rgba;			//base color (RGBA)
int vbo_aface_slrgba;		//sun-light color (RGBA)
int vbo_aface_vlrgba;		//vox-light color (RGBA)
int vbo_aface_tlrgba;		//temp light color (RGBA)

//sound
char *sound_name;
int sound_chan;
};

struct BTGE_VoxelRegion_s {
BTGE_VoxelRegion *next;		//next region (in world)
BTGE_VoxelChunk **chk;		//voxel chunk array
BTGE_VoxelChunk *vischk;	//visible chunk list
BTGE_VoxelChunk *avischk;	//alpha visible chunk list
BTGE_VoxelChunk *lvischk;	//light visible chunk list
BTGE_VoxelChunk *svischk;	//shadow visible chunk list
int ox, oy, oz;				//origin (voxel space)
int xs, ys, zs;				//region size (chunks)
int xsv, ysv, zsv;			//region size (voxels)
int xst, yst, zst;			//chunk size (voxels)
int xss, yss, zss;			//chunk shift (voxels)
float voxsz;				//voxel size (units)
int flags;					//region flags

dyt *values;				//values table
dyt *oldvalues;				//old values table
int n_values;				//num values
int m_values;				//max values

//region entities
int rgn_id;					//region ID number
BTGE_SEntity *sentity;		//regional S-Entities
BTGE_Brush *brush;
BTGE_BrushModel *bmdl;		//region brush-models

//savestate
VFILE *img_fd;				//saved image file
int *chk_offs;				//chunk offsets
int *chk_sz;				//chunk sizes
byte *img_buf;				//image buffer
byte *img_map;				//image cell bitmap
int img_n_cells;			//num cells in image
int img_m_cells;			//max cells in image
int img_idx_offs;			//image index offset
int img_idx_sz;				//image index size
int img_cont_offs;			//image contents offset
int img_cont_sz;			//image contents size
int img_vals_offs;			//image values offset
int img_vals_sz;			//image values size

int img_voxty_offs;			//image values offset
int img_voxty_sz;			//image values size

int img_sent_offs;			//image S-Entity offset
int img_sent_sz;			//image S-Entity size

int img_cell_rov;			//image cell rover

//
BTGE_VoxelRegion *chain;	//chain
int rgn_tick_inactive;		//ticks inactive

//ESN
BTGE_VoxelElasticVertex *esn_vertex;

//region-specific data
// char **rgn_voxnames;
// char **rgn_oldvoxnames;
// BTGE_VoxelInfo **rgn_voxinfo;

//noise
BTGE_NoiseContext *noise1;
BTGE_NoiseContext *noise2;
BTGE_NoiseContext *noise3;
BTGE_NoiseContext *noise4;
};



struct BTGE_VoxelBiomeInfo_s {
char *name;			//name of biome type
int id;				//id of biome

float val_arcane;
float val_temperature;
float val_humidity;

float clr_grass[3];
float clr_water[3];
float clr_sun[3];

//generator settings
int flags;
int vox_stone;
int vox_dirt;
int vox_grass;
int vox_grass2;
int vox_sand;
int vox_water;
int vox_lava;
};

struct BTGE_VoxelOreInfo_s {
int ty;			//type
float wf;		//weight factor
int fl;			//flags
};

struct BTGE_VoxelTerrGen_s {
BTGE_NoiseContext *noise;
BTGE_NoiseContext *noise2;
BTGE_NoiseContext *noise3;
BTGE_NoiseContext *noise4;

//basic span generators
void (*GenerateSpan[16])(BTGE_BrushWorld *world,
	BTGE_VoxelTerrGen *terr, int x, int y);
char *GenerateSpan_name[16];
int n_GenerateSpan;
s64 seed;

//world image file
VFILE *img_fd;		//saved image file
byte *img_buf;		//image buffer
byte *img_map;		//image cell bitmap
int img_n_cells;	//num cells in image
int img_m_cells;	//max cells in image

//generator settings
int flags;
int vox_stone;
int vox_dirt;
int vox_grass;
int vox_grass2;
int vox_sand;
int vox_water;
int vox_lava;

BTGE_VoxelOreInfo *ores;
int n_ores;

BTGE_VoxelBiomeInfo **biomes;
int n_biomes;

char *portal_map[16];

int world_xs;		//world plane X size
int world_ys;		//world plane Y size
byte *world_map;	//height, biome, 0, 255
byte *world_maprgb;	//r, g, b, 255

int world_minx;		//world plane min X
int world_miny;		//world plane min Y
int world_maxx;		//world plane min X
int world_maxy;		//world plane min Y
};

struct BTGE_NoiseContext_s {
float *arr[4];	//value arrays
int *parr[4];		//permutation array
int ord;		//order of context
int sz;			//size of array
s64 seed;
};
